---
title: "Kaggle competition Prudential Life Insurance Assessment"
output: html_notebook
---

This notebook defines our solution for the Kaggle competition "Prudential Life Insurance Assessment".

```{r}
library(mlr3)
library(mlr3verse)
library(mlr3learners)
library(mlr3pipelines)
library(Metrics)
```

## Load the data

```{r}
set.seed(123)

data <- read.csv("data/train.csv")

# create a mlr3 task
task_regr <- as_task_regr(data, target = "Response")

# split the data into training and testing sets
split <- partition(task_regr, ratio = 0.8)
```

## Preprocess the data using ml3 pipelines

The data contains many features and requires intensive preprocessing to successfully train a model.

```{r}
data_train = task_regr$data(rows = split$train)

# get a list of features with more than 30% missing values
threshold <- 0.3
missing_features_rmv <- colnames(data_train)[colMeans(is.na(data_train)) > threshold]
selected_features <- setdiff(colnames(data_train), append(missing_features_rmv, "Id"))
```

Create a pipeline to preprocess the data.

```{r}
po_select <- po("select", affect_columns = selector_name(selected_features))
po_impute <- po("imputemean")
```


```{r}
pipeline <- po_select %>>% po_impute
```


```{r}
# check the result of the pipeline
result = pipeline$train(list(task_regr))

result[[1]]$data()
```


```{r}
resampling = rsmp("cv", folds = 5)
rr = resample(task_regr, learner, resampling)

source("scripts/qwk_measure.R")
measure = MeasureRegrQuadraticWeightedKappa$new()

rr$aggregate(measure)
```
